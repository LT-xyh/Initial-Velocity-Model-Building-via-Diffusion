from datetime import datetime

import torch
from omegaconf import OmegaConf

from lightning_modules.Autoencoder.autoencoder_kl_lightning import AutoencoderKLLightning
from scripts.trains.basetrain import base_train


def train_autoencoder_kl():
    torch.set_float32_matmul_precision('medium')  # 设置矩阵乘法精度利用Tensor Cores
    conf = OmegaConf.load('configs/autoencoder_kl.yaml')
    # 获取当前日期时间
    current_date = datetime.now()
    date_str = current_date.strftime("%m%d")
    conf.training.logging.log_version = "all_data" + date_str

    model = AutoencoderKLLightning(conf)
    base_train(model, conf, fast_run=False, use_lr_finder=False, )


if __name__ == '__main__':
    train_autoencoder_kl()
